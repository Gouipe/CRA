@model IEnumerable<CRA.Models.LigneSaisie>
@{
    Layout = "~/Views/Shared/_userLayout.cshtml";
    ViewBag.Title = "Compte Rendu";
}
@if (ViewBag.feedback != null)
{
    <script>
        window.alert("@ViewBag.feedback");
    </script>
}

<br />

<h2>Choix semaine</h2>
<div>
    @using (Html.BeginForm("CompteRendu", "User", FormMethod.Post))
    {
        <input type="date" name="date" />
        <input type="submit" value="Choix semaine" />
    }
</div>
<br />

<h2>Ajouter une ligne de saisie</h2>
<div>
    <form action="/User/AjoutLigne" method="post">
        <div>
            <label>Mission</label>
            <select data-val="true" data-val-required="Le champ Mission est requis." id="Mission" name="Mission">
                @foreach (var mission in ViewBag.currentEmployee.Missions)
                {
                    <option>@mission</option>
                }

            </select>
        </div>
        <div>
            <label for="MissionDay">MissionDay</label>
            <input type="date" name="date">
            <span class="field-validation-valid" data-valmsg-for="MissionDay" data-valmsg-replace="true"></span>
        </div>
        <div>
            <label for="Comment">Comment</label>
            <input class="text-box single-line" id="Comment" name="Comment" type="text" value="">
        </div>
        <div>
            <label for="FractionDay">FractionDay</label>
            <select name="fractionDay">
                <option>matin</option>
                <option>apres_midi</option>
            </select>
        </div>
        <input type="submit" value="Ajouter Ligne Saisie">
    </form>
</div>

@if (ViewBag.lignes != null)
{
    <h2>Lignes déjà saisies:</h2>
    <table class="table">
        <tr>
            <th>@Html.DisplayNameFor(model => model.MissionDay)</th>
            <th>@Html.DisplayNameFor(model => model.FractionDay)</th>
            <th>@Html.DisplayNameFor(model => model.Mission)</th>
            <th>@Html.DisplayNameFor(model => model.Comment)</th>
            <th>Modifier</th>
            <th>Supprimer</th>
        </tr>

        @foreach (var ligne in ViewBag.lignes)

        {
            <tr class="@(ligne.State)">
                <td>@(ligne.MissionDay.ToShortDateString())</td>
                <td>@(ligne.FractionDay)</td>
                <td>@(ligne.Mission.Libelle)</td>
                <td>@(ligne.Comment) </td>
                <td>
                    @if (ligne.State != "sent")
                    {@Html.ActionLink("Modifier", "UpdateLigne", new { id = ligne.Ligne_id })}
                </td>
                <td>@Html.ActionLink("Supprimer", "DeleteLigne", new { id = ligne.Ligne_id })</td>

            </tr>
            
            }

</table>
}

@using (Html.BeginForm("EnvoyerLignes", "User", FormMethod.Post))
{
    <button type="submit" class="btn btn-primary">Envoyer</button>
}